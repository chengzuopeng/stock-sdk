---
description: Stock SDK 项目开发规范
globs: 
alwaysApply: true
---

# Stock SDK 项目规范

## 项目概述

这是一个用于获取股票行情数据的 TypeScript SDK，支持 A 股、港股、美股和公募基金。该 SDK 可在浏览器和 Node.js 环境中运行，零依赖，轻量。

## 技术栈

- **语言**: TypeScript 5.x
- **运行环境**: Node.js 18+ / 浏览器
- **构建工具**: tsup
- **测试框架**: Vitest
- **文档工具**: VitePress
- **包管理器**: Yarn 1.x

## 项目结构

```
src/
├── core/           # 核心功能模块（请求、解析、工具函数）
├── indicators/     # 技术指标计算（MA、MACD、BOLL、KDJ 等）
├── providers/      # 数据提供商
│   ├── eastmoney/  # 东方财富 K 线数据
│   └── tencent/    # 腾讯行情数据
├── sdk.ts          # SDK 主类
├── types.ts        # 类型定义
└── index.ts        # 导出入口
```

## 代码规范

### TypeScript 规范

1. **始终使用严格类型**，避免使用 `any`
2. **所有公共 API 必须有完整的类型定义**
3. **使用 `interface` 定义对象类型**，使用 `type` 定义联合类型或工具类型
4. **导出的函数和类必须有 JSDoc 注释**

```typescript
/**
 * 获取 A 股实时行情
 * @param codes - 股票代码数组，如 ['sh600519', 'sz000858']
 * @returns 行情数据数组
 */
export async function getQuotes(codes: string[]): Promise<Quote[]> {
  // ...
}
```

### 命名规范

- **文件名**: 使用 camelCase，如 `aShareKline.ts`
- **类名**: 使用 PascalCase，如 `StockSDK`
- **函数名**: 使用 camelCase，如 `getFullQuotes`
- **常量**: 使用 UPPER_SNAKE_CASE，如 `DEFAULT_TIMEOUT`
- **类型/接口**: 使用 PascalCase，如 `QuoteData`

### 代码风格

1. **使用 ES Module 导入/导出**
2. **异步操作使用 async/await**
3. **避免使用 `export default`**，除非是主入口文件
4. **错误处理要明确**，提供有意义的错误信息

## 新增功能开发流程

### 添加新的数据接口

1. 在 `src/providers/` 下对应的提供商目录中创建新文件
2. 在 `src/types.ts` 中定义相关类型
3. 在 `src/sdk.ts` 中添加公共方法
4. 在 `src/index.ts` 中导出新类型
5. 完成开发后检查清单（见下方）

### 添加新的技术指标

1. 在 `src/indicators/` 目录下创建新的指标文件
2. 在 `src/indicators/types.ts` 中定义配置类型
3. 在 `src/indicators/index.ts` 中导出
4. 在 `src/indicators/addIndicators.ts` 中集成
5. 完成开发后检查清单（见下方）

## ⚠️ 开发完成后必做检查清单

**每次对 `src/` 目录下的代码进行新增或修改功能时（如增加方法、增加指标等），必须完成以下所有步骤：**

### 1. 确保构建成功

```bash
yarn build
```

- 构建必须无错误通过
- 检查 `dist/` 目录下的输出文件是否正确生成

### 2. 补充测试用例并确保单测通过

```bash
yarn test
```

- 为新增/修改的功能编写对应的测试用例
- 测试文件位于 `src/index.test.ts`
- 确保所有测试通过，无失败用例

### 3. 更新 README 文档

- **中文文档**: 更新 `README.md`
- **英文文档**: 同步更新 `README_EN.md`
- 如果新增了公共 API，需要在 API 列表中添加说明

### 4. 更新 website 文档

- **中文文档**: 更新 `website/` 目录下对应的 `.md` 文件
  - API 文档在 `website/api/` 目录
  - 使用指南在 `website/guide/` 目录
- **英文文档**: 同步更新 `website/en/` 目录下对应的 `.md` 文件
  - API 文档在 `website/en/api/` 目录
  - 使用指南在 `website/en/guide/` 目录
- 确保中英文文档内容一致

### 5. 更新 Playground（如需要）

- 如果新增的功能适合在 Playground 中演示，需要更新：
  - `website/playground/index.md`
  - `website/en/playground/index.md`
- 确保 Playground 示例可以正常运行

### 检查清单总结

```
□ yarn build 成功
□ yarn test 通过
□ README.md 已更新
□ README_EN.md 已更新
□ website/ 中文文档已更新
□ website/en/ 英文文档已更新
□ Playground 已更新（如需要）
```

## 构建与发布

```bash
# 构建
yarn build

# 本地开发
yarn dev

# 文档开发
yarn dev:docs

# 文档构建
yarn build:docs
```

## 文档规范

- 文档位于 `website/` 目录
- 支持中英文双语（英文在 `website/en/`）
- API 文档在 `website/api/` 目录
- 使用 VitePress 构建

## Git 提交规范

使用语义化提交信息：

- `feat`: 新功能
- `fix`: 修复 bug
- `docs`: 文档更新
- `refactor`: 代码重构
- `test`: 测试相关
- `chore`: 构建/工具相关

示例: `feat: 添加创业板指数支持`

## 注意事项

1. **保持零依赖**：不引入任何运行时依赖
2. **双端兼容**：代码需要同时在浏览器和 Node.js 中运行
3. **向后兼容**：公共 API 的变更需要考虑向后兼容性
4. **中文支持**：处理 GBK 编码时使用 `decodeGBK` 工具函数
